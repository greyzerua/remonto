# Background –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó - –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

## üì± Cloud Functions –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (–ø—Ä–∞—Ü—é—é—Ç—å –∑–∞–≤–∂–¥–∏)

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ Cloud Functions –¥–ª—è –≤—Å—ñ—Ö –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å –∑–º—ñ–Ω–∏ –≤ Firestore
- –í—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å FCM –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ –∑–∞–∫—Ä–∏—Ç–∏–π
- –ü—Ä–∞—Ü—é—é—Ç—å –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å—Ç–∞–Ω—É –¥–æ–¥–∞—Ç–∫—É

**–Ø–∫ –ø—Ä–∞—Ü—é—é—Ç—å:**

- –í—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å –∑–º—ñ–Ω–∏ –≤ Firestore —á–µ—Ä–µ–∑ Cloud Functions
- –í—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å FCM –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ Firebase Cloud Messaging
- –ü—Ä–∞—Ü—é—é—Ç—å –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–∫—Ä–∏—Ç–∏–π

**–ö–æ–ª–∏ —Å–ø—Ä–∞—Ü—å–æ–≤—É—é—Ç—å:**
- ‚úÖ –ö–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π
- ‚úÖ –ö–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ —É —Ñ–æ–Ω—ñ
- ‚úÖ –ö–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ –∑–∞–∫—Ä–∏—Ç–∏–π (–ø–æ–≤–Ω—ñ—Å—Ç—é)

**–©–æ –≤—ñ–¥—Å—Ç–µ–∂—É—î—Ç—å—Å—è:**
- –ù–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ø—Ä–æ—î–∫—Ç—ñ–≤ (`onProjectAccessGranted`)
- –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç (`onExpenseAdded`)
- –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –ø—Ä–æ—î–∫—Ç—ñ–≤ (`onProjectMemberAdded`)

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Cloud Functions

### –ö—Ä–æ–∫ 1: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Firebase CLI

```bash
npm install -g firebase-tools
```

### –ö—Ä–æ–∫ 2: –í—Ö—ñ–¥ —É Firebase

```bash
firebase login
```

### –ö—Ä–æ–∫ 3: –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Functions

```bash
cd d:\remonto
firebase init functions
```

**–í–∏–±–µ—Ä—ñ—Ç—å:**
- ‚úÖ Use an existing project (–≤–∏–±–µ—Ä—ñ—Ç—å –≤–∞—à –ø—Ä–æ—î–∫—Ç)
- ‚úÖ JavaScript
- ‚úÖ Yes (install dependencies)

### –ö—Ä–æ–∫ 4: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
cd functions
npm install
```

### –ö—Ä–æ–∫ 5: –î–µploy Cloud Functions

```bash
cd d:\remonto
firebase deploy --only functions
```

## üìã –Ø–∫—ñ –ø–æ–¥—ñ—ó –≤—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å—Å—è

### 1. –ù–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ø—Ä–æ—î–∫—Ç—ñ–≤
- **–¢—Ä–∏–≥–µ—Ä:** –ó–º—ñ–Ω–∞ –≤ `users/{userId}.sharedUsers`
- **–ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è:** "–î–æ—Å—Ç—É–ø –Ω–∞–¥–∞–Ω–æ" - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É, —è–∫–∏–π –æ—Ç—Ä–∏–º–∞–≤ –¥–æ—Å—Ç—É–ø
- **Cloud Function:** `onProjectAccessGranted`

### 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—Ç–∏
- **–¢—Ä–∏–≥–µ—Ä:** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ `expenses/{expenseId}`
- **–ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è:** "–ù–æ–≤–∞ –≤–∏—Ç—Ä–∞—Ç–∞" - –≤—Å—ñ–º —á–ª–µ–Ω–∞–º –ø—Ä–æ—î–∫—Ç—É (–∫—Ä—ñ–º —Ç–æ–≥–æ, —Ö—Ç–æ –¥–æ–¥–∞–≤)
- **Cloud Function:** `onExpenseAdded`

### 3. –î–æ–¥–∞–≤–∞–Ω–Ω—è –¥–æ –ø—Ä–æ—î–∫—Ç—É
- **–¢—Ä–∏–≥–µ—Ä:** –ó–º—ñ–Ω–∞ –≤ `projects/{projectId}.members`
- **–ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è:** "–ù–æ–≤–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –ø—Ä–æ—î–∫—Ç—É" - –Ω–æ–≤–∏–º —á–ª–µ–Ω–∞–º
- **Cloud Function:** `onProjectMemberAdded`

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Cloud Functions –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π

1. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –¥–æ–¥–∞—Ç–æ–∫
2. –£–≤—ñ–π–¥—ñ—Ç—å —É –¥–æ–¥–∞—Ç–æ–∫
3. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí –ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó ‚Üí –£–≤—ñ–º–∫–Ω—ñ—Ç—å
4. **–ü–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–∫—Ä–∏–π—Ç–µ –¥–æ–¥–∞—Ç–æ–∫** (swipe away) –∞–±–æ –∑–∞–ª–∏—à—Ç–µ —É —Ñ–æ–Ω—ñ
5. –ó —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é/–∞–∫–∞—É–Ω—Ç—É:
   - –ù–∞–¥–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –ø—Ä–æ—î–∫—Ç—É ‚Üí –º–∞—î —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ `onProjectAccessGranted`
   - –î–æ–¥–∞–π—Ç–µ –≤–∏—Ç—Ä–∞—Ç—É –¥–æ –ø—Ä–æ—î–∫—Ç—É ‚Üí –º–∞—î —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ `onExpenseAdded`
   - –î–æ–¥–∞–π—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ –ø—Ä–æ—î–∫—Ç—É ‚Üí –º–∞—î —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ `onProjectMemberAdded`
6. –ú–∞—î –ø—Ä–∏–π—Ç–∏ FCM –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (—á–µ—Ä–µ–∑ Cloud Functions)

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏ Cloud Functions

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Firebase Console ‚Üí Functions
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–∞–¥–µ–ø–ª–æ—î–Ω—ñ
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏: Functions ‚Üí Logs
4. –ü—Ä–∏ –ø–æ–¥—ñ—è—Ö –º–∞—é—Ç—å –∑'—è–≤–ª—è—Ç–∏—Å—è –ª–æ–≥–∏ –ø—Ä–æ –≤—ñ–¥–ø—Ä–∞–≤–∫—É –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- **Cloud Functions –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó** –ø—Ä–∞—Ü—é—é—Ç—å –∑–∞–≤–∂–¥–∏ (–Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ –∑–∞–∫—Ä–∏—Ç–∏–π)
- Cloud Functions –ø–æ—Ç—Ä–µ–±—É—é—Ç—å Blaze –ø–ª–∞–Ω—É –≤ Firebase
- Cloud Functions –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –¥–µ–ø–ª–æ—é –≤ Firebase
- Toast –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π (foreground)

## üí° –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

1. **Toast** - –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π (UI –µ–ª–µ–º–µ–Ω—Ç)
2. **Cloud Functions** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å –∑–º—ñ–Ω–∏ –≤ Firestore —ñ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å FCM –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
3. **FCM –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó** - –ø—Ä–∏—Ö–æ–¥—è—Ç—å –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ –∑–∞–∫—Ä–∏—Ç–∏–π

–í—Å—ñ background –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è —á–µ—Ä–µ–∑ Cloud Functions –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ!

